{% extends "base.html" %}
{% block content %}
<div class="row mb-12">
  <h1 class="right-0">Your Dashboard</h1>
  <div class="right actions">
    <a class="btn" href="{% url 'portal_calendar' %}">View Calendar</a>
    <a class="btn primary" href="{% url 'portal_book' %}">Book a Walk</a>
  </div>
  <div class="sep"></div>
</div>

<div class="grid cols-2">
  <section class="card">
    <h2>Upcoming (next 30 days)</h2>
    {% if upcoming %}
      <ul class="list">
        {% for b in upcoming %}
          <li class="row">
            <div>
              <div><strong>{{ b.service.name|default:b.service_name }}</strong></div>
              <div class="muted mono">{{ b.start_dt }} → {{ b.end_dt }}</div>
            </div>
            <div class="right row">
              {% if b.requires_admin_review %}
                <span class="chip warn" title="Awaiting staff review">under review</span>
              {% endif %}
              {% if b.invoice_pdf_url %}
                <a class="btn" href="{{ b.invoice_pdf_url }}" target="_blank" rel="noopener">Open invoice</a>
              {% elif b.stripe_invoice_id %}
                <span class="chip">invoice pending…</span>
              {% endif %}
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="empty">
        No upcoming bookings.<br>
        <a class="btn mt-8" href="{% url 'portal_book' %}">Book your next walk</a>
      </div>
    {% endif %}
  </section>

  <section class="card">
    <h2>Recent Past (last 30 days)</h2>
    {% if past %}
      <ul class="list">
        {% for b in past %}
          <li class="row">
            <div>
              <div><strong>{{ b.service.name|default:b.service_name }}</strong></div>
              <div class="muted mono">{{ b.start_dt }}</div>
            </div>
            {% if b.invoice_pdf_url %}
              <div class="right"><a class="btn" href="{{ b.invoice_pdf_url }}" target="_blank" rel="noopener">Open invoice</a></div>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="empty">No recent walks to show.</div>
    {% endif %}
  </section>
</div>
{% endblock %}

