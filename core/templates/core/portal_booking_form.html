{% extends "core/base.html" %}
{% load money_filters %}
{% block content %}
<h2 class="mb-3">New booking</h2>

{% if form_error %}
  <div class="alert alert-warning" role="alert">
    {{ form_error }}
  </div>
{% endif %}

<form method="post" class="card p-3" data-disable-on-submit>
  {% csrf_token %}
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Service</label>
      <select name="service_price_id" class="form-select" required>
        <option value="">Select a service…</option>
        {% for value,label in service_choices %}
          <option value="{{ value }}" {% if defaults.service_price_id == value %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Start</label>
      <input type="datetime-local" name="start_dt" class="form-control" value="{{ defaults.start_dt|default:'' }}" required>
    </div>
    <div class="col-md-3">
      <label class="form-label">End</label>
      <input type="datetime-local" name="end_dt" class="form-control" value="{{ defaults.end_dt|default:'' }}" required>
    </div>
    <div class="col-12">
      <label class="form-label">Location</label>
      <input type="text" name="location" class="form-control" value="{{ defaults.location|default:'' }}" placeholder="e.g., New Farm Park">
    </div>
    <div class="col-12">
      <label class="form-label">Notes (optional)</label>
      <textarea name="notes" class="form-control" rows="3">{{ defaults.notes|default:'' }}</textarea>
    </div>
  </div>
  <div class="d-flex align-items-center gap-2 mt-3">
    <button class="btn btn-success" type="submit" id="portalSubmitBtn">Check & create</button>
    <span id="checkingHint" class="text-muted small" style="display:none;" aria-live="polite">Checking availability…</span>
    <a class="btn btn-outline-secondary" href="{% url 'portal_home' %}">Cancel</a>
  </div>
</form>

<script>
  (function(){
    const form = document.querySelector('form[data-disable-on-submit]');
    const hint = document.getElementById('checkingHint');
    if (form && hint) {
      form.addEventListener('submit', function(){ hint.style.display = 'inline'; });
    }
  })();
</script>
{% endblock %}