{% extends "core/base.html" %}
{% load dict_filters %}
{% block content %}
<h1>Subscription â†’ Service & Time Mapping</h1>
<table border="1" cellpadding="6">
  <tr>
    <th>Client</th>
    <th>Subscription</th>
    <th>Service</th>
    <th>Repeats</th>
    <th>Days (e.g. MON,THU)</th>
    <th>Start</th>
    <th>Location</th>
    <th>Save</th>
  </tr>
  {% for l in links %}
    {% with s=schedules|get_item:l.stripe_subscription_id %}
    <tr>
      <td>{{ l.client }}</td>
      <td>{{ l.stripe_subscription_id }}</td>
      <td>
        <form method="post" action="{% url 'admin_sub_link_save' l.id %}">
          {% csrf_token %}
          <select name="service_code">
            <option value="">--</option>
            {% for svc in services %}
              <option value="{{ svc.code }}" {% if l.service_code == svc.code %}selected{% endif %}>{{ svc.name }}</option>
            {% endfor %}
          </select>
      </td>
      <td>
        <select name="repeats">
          <option value="weekly" {% if s and s.repeats == 'weekly' %}selected{% endif %}>Weekly</option>
          <option value="fortnightly" {% if s and s.repeats == 'fortnightly' %}selected{% endif %}>Fortnightly</option>
        </select>
      </td>
      <td><input type="text" name="days" placeholder="MON,THU" value="{% if s %}{{ s.days|default_if_none:'' }}{% endif %}"></td>
      <td><input type="text" name="start_time" placeholder="10:30" value="{% if s %}{{ s.start_time|default_if_none:'' }}{% endif %}"></td>
      <td><input type="text" name="location" placeholder="Home" value="{% if s %}{{ s.location|default_if_none:'' }}{% endif %}"></td>
      <td><button type="submit">Save</button></td>
        </form>
    </tr>
    {% endwith %}
  {% endfor %}
</table>
{% endblock %}
