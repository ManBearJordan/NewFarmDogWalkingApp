{% extends "admin/base_site.html" %}

{% block title %}{{ title }} | Django site admin{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">Home</a>
    › {{ title }}
</div>
{% endblock %}

{% block content %}
<div class="content">
    <h1>{{ title }}</h1>
    
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    
    <div class="module">
        <h2>Current Status</h2>
        <table class="table">
            <tbody>
                <tr>
                    <th>Configured:</th>
                    <td>
                        {% if status.configured %}
                            <span style="color: green;">✓ Yes</span>
                        {% else %}
                            <span style="color: red;">✗ No</span>
                        {% endif %}
                    </td>
                </tr>
                <tr>
                    <th>Mode:</th>
                    <td>
                        {% if status.mode == 'test' %}
                            <span style="color: orange;">Test Mode</span>
                        {% elif status.mode == 'live' %}
                            <span style="color: red;">Live Mode</span>
                        {% else %}
                            <span style="color: gray;">Not configured</span>
                        {% endif %}
                    </td>
                </tr>
                {% if masked_key %}
                <tr>
                    <th>Current Key:</th>
                    <td><code>{{ masked_key }}</code></td>
                </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
    
    <div class="module">
        <h2>Update Stripe Key</h2>
        <form method="post" action="">
            {% csrf_token %}
            <div class="form-row">
                <label for="stripe_key">Stripe Secret Key:</label>
                <input type="password" 
                       id="stripe_key" 
                       name="stripe_key" 
                       placeholder="sk_test_... or sk_live_..." 
                       style="width: 400px; font-family: monospace;" 
                       required>
            </div>
            <div class="form-row">
                <input type="submit" value="Update Key" class="default">
            </div>
        </form>
    </div>
    
    <div class="module">
        <h2>Diagnostics</h2>
        <p>
            <button onclick="checkStripeStatus()" class="button">Check Stripe Status</button>
        </p>
        <div id="diagnostics-result" style="margin-top: 10px;"></div>
    </div>
</div>

<script>
function checkStripeStatus() {
    const resultDiv = document.getElementById('diagnostics-result');
    resultDiv.innerHTML = '<em>Checking...</em>';
    
    fetch('/admin/stripe/diagnostics/')
        .then(response => response.json())
        .then(data => {
            const html = `
                <div style="background: #f8f9fa; padding: 10px; border-radius: 4px;">
                    <h4>Diagnostics Result:</h4>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
            resultDiv.innerHTML = html;
        })
        .catch(error => {
            resultDiv.innerHTML = `<div style="color: red;">Error: ${error.message}</div>`;
        });
}
</script>

<style>
.alert {
    padding: 10px;
    margin-bottom: 15px;
    border-radius: 4px;
}
.alert-success {
    background-color: #d4edda;
    border-color: #c3e6cb;
    color: #155724;
}
.alert-error {
    background-color: #f8d7da;
    border-color: #f5c6cb;
    color: #721c24;
}
.table {
    width: 100%;
    border-collapse: collapse;
}
.table th, .table td {
    padding: 8px 12px;
    text-align: left;
    border-bottom: 1px solid #ddd;
}
.table th {
    font-weight: bold;
    background-color: #f5f5f5;
}
</style>
{% endblock %}